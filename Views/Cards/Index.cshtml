@model List<AiMagicCardsGenerator.Models.Entities.Card>

@{
    ViewData["Title"] = "Browse Cards";
    var totalPages = (int)Math.Ceiling((double)ViewBag.TotalCount / 50);
}

@functions {
    public static string RenderManaCost(string? manaCost)
    {
        if (string.IsNullOrEmpty(manaCost)) return "-";

        var result = System.Text.RegularExpressions.Regex.Replace(
            manaCost,
            @"\{([^}]+)\}",
            match => $"<img src=\"/assets/symbols/{match.Groups[1].Value}.svg\" class=\"mana-symbol\" alt=\"{match.Groups[1].Value}\" />"
        );

        return result;
    }
}

<style>
    .mana-symbol {
        width: 20px;
        height: 20px;
        vertical-align: middle;
        margin: 0 1px;
    }

    .mana-cost {
        display: inline-flex;
        align-items: center;
        gap: 2px;
    }

    .rarity-common { color: var(--text-muted); }
    .rarity-uncommon { color: #C0C0C0; }
    .rarity-rare { color: var(--gold-primary); }
    .rarity-mythic { color: #F4631E; }

    @@media (max-width: 768px) {
        .hide-mobile {
            display: none;
        }
    }
</style>

<div class="page-header" data-aos="fade-up">
    <h1 class="section-title">
        <i class="fas fa-book"></i>
        Card Database
    </h1>
    <p class="hero-subtitle">@ViewBag.TotalCount cards in the collection</p>
</div>

<div class="card bg-dark-card border-gold mb-4" data-aos="fade-up" >
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <input type="text"
                       name="search"
                       class="form-control"
                       placeholder="Search by name..."
                       value="@ViewBag.Search">
            </div>
            <div class="col-md-3">
                <select name="type" class="form-select">
                    <option value="">All Types</option>
                    <option value="Creature">Creature</option>
                    <option value="Instant">Instant</option>
                    <option value="Sorcery">Sorcery</option>
                    <option value="Enchantment">Enchantment</option>
                    <option value="Artifact">Artifact</option>
                    <option value="Land">Land</option>
                    <option value="Planeswalker">Planeswalker</option>
                </select>
            </div>
            <div class="col-md-3">
                <select name="rarity" class="form-select">
                    <option value="">All Rarities</option>
                    <option value="common">Common</option>
                    <option value="uncommon">Uncommon</option>
                    <option value="rare">Rare</option>
                    <option value="mythic">Mythic</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-action btn-share w-100">
                    <i class="fas fa-search"></i>
                    Search
                </button>
            </div>
        </form>
    </div>
</div>

<div class="pagination-container" data-aos="fade-up" >
    <a href="/Cards?page=@(ViewBag.Page - 1)" class="pagination-btn @(ViewBag.Page <= 1 ? "disabled" : "")">
        <i class="fas fa-chevron-left"></i>
        Previous
    </a>
    <span class="pagination-info">
        Page <strong>@ViewBag.Page</strong> of <strong>@totalPages</strong>
    </span>
    <a href="/Cards?page=@(ViewBag.Page + 1)" class="pagination-btn @(ViewBag.Page >= totalPages ? "disabled" : "")">
        Next
        <i class="fas fa-chevron-right"></i>
    </a>
</div>

<div class="card bg-dark-card border-gold" data-aos="fade-up" >
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead>
            <tr>
                <th>Name</th>
                <th>Mana Cost</th>
                <th class="hide-mobile">Type</th>
                <th>P/T</th>
                <th class="hide-mobile">Rarity</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var card in Model)
            {
                var rarityClass = card.Rarity switch
                {
                    "common"   => "rarity-common",
                    "uncommon" => "rarity-uncommon",
                    "rare"     => "rarity-rare",
                    "mythic"   => "rarity-mythic",
                    _          => ""
                };

                <tr>
                    <td>
                        <a href="/Cards/Details/@card.Id" class="text-gold text-decoration-none">
                            @card.Name
                        </a>
                    </td>
                    <td>
                        <span class="mana-cost">@Html.Raw(RenderManaCost(card.ManaCost))</span>
                    </td>
                    <td class="hide-mobile text-muted-custom">@card.TypeLine</td>
                    <td class="text-gold">@(card.Power != null ? card.Power + "/" + card.Toughness : "-")</td>
                    <td class="hide-mobile">
                        <span class="@rarityClass fw-semibold">
                            @(string.IsNullOrEmpty(card.Rarity) ? "-" : char.ToUpper(card.Rarity[0]) + card.Rarity.Substring(1))
                        </span>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<div class="pagination-container" data-aos="fade-up">
    <a href="/Cards?page=@(ViewBag.Page - 1)" class="pagination-btn @(ViewBag.Page <= 1 ? "disabled" : "")">
        <i class="fas fa-chevron-left"></i>
        Previous
    </a>
    <span class="pagination-info">
        Page <strong>@ViewBag.Page</strong> of <strong>@totalPages</strong>
    </span>
    <a href="/Cards?page=@(ViewBag.Page + 1)" class="pagination-btn @(ViewBag.Page >= totalPages ? "disabled" : "")">
        Next
        <i class="fas fa-chevron-right"></i>
    </a>
</div>
